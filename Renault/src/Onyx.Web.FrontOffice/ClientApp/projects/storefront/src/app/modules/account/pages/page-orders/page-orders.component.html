<div class="card">
    <div class="card-header">
        <h5>{{ 'HEADER_ORDER_HISTORY' | translate }}</h5>
    </div>

    <ng-container *ngIf="list && list.items && list.items.length">
        <div class="card-divider"></div>
        <div class="card-table">
            <div class="table-responsive-sm">
                <table class="table">
                    <thead>
                        <tr>
                            <th>{{ 'TABLE_NUMBER' | translate }}</th>
                            <th>{{ 'TABLE_DATE' | translate }}</th>
                            <th>{{ 'TABLE_STATUS' | translate }}</th>
                            <th>{{ 'TABLE_TOTAL' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let order of list.items">
                            <td>
                                <a [routerLink]="url.order(order)">
                                    {{ 'FORMAT_ORDER_NUMBER' | translate: { number: order.number } }}
                                </a>
                            </td>
                            <td>{{ order.createdAt }}</td>
                            <td>{{ order.status }}</td>
                            <td>{{ 'TEXT_ORDER_TOTAL' | translate: { total: order.total | currencyFormat, quantity: order.quantity } }}</td>
                            <td class="d-flex justify-content-start">
                                <button (click)="payOrder(order.id)"   *ngIf="order.CurrentOrderStatus == 0" class="btn btn-secondary btn-sm me-2">پرداخت</button>

                                <!-- Cancel Order Button with Loading State -->
                                <button *ngIf="order.CurrentOrderStatus == 0"
                                    class="btn btn-primary btn-sm me-2" 
                                    (click)="openDeleteConfirmationModal(deleteConfirmationTemplate , order.id)"
                                    [disabled]="isDeleting[order.id]" 
                                    >
                                    <ng-container *ngIf="isDeleting[order.id]; else deleteText">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                        در حال حذف...
                                    </ng-container>
                                    <ng-template #deleteText>
                                        حذف سفارش
                                    </ng-template>
                                </button>

                                <!-- Update Order Button with Loading State -->
                                <button *ngIf="order.CurrentOrderStatus == 0"
                                    class="btn btn-secondary btn-sm" 
                                    [disabled]="isUpdating[order.id]" 
                                    (click)="updateOrder(order.id)">
                                    <ng-container *ngIf="isUpdating[order.id]; else updateText">
                                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                        در حال به روز رسانی...
                                    </ng-container>
                                    <ng-template #updateText>
                                        به روز رسانی
                                    </ng-template>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-divider"></div>
        <div class="card-footer">
            <app-pagination [formControl]="currentPage" [siblings]="2" [total]="list.pages"></app-pagination>
        </div>
    </ng-container>

    <ng-container *ngIf="!list?.items?.length">
        <!-- Empty Table Structure when No Orders -->
        <div class="table-responsive-sm">
            <table class="table">
                <thead>
                    <tr>
                        <th>{{ 'TABLE_NUMBER' | translate }}</th>
                        <th>{{ 'TABLE_DATE' | translate }}</th>
                        <th>{{ 'TABLE_STATUS' | translate }}</th>
                        <th>{{ 'TABLE_TOTAL' | translate }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" class="text-center">
                            <!-- Empty table body when no orders exist -->
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Pagination remains functional -->
        <div class="card-footer">
            <app-pagination [formControl]="currentPage" [siblings]="2" [total]="list.pages"></app-pagination>
        </div>
    </ng-container>
</div>
<ng-template #deleteConfirmationTemplate>
    <div class="modal-header custom-modal-header">
      <h4 class="modal-title mb-0">آیا از حذف سفارش مطمئن هستید؟</h4>
      <button type="button" class="close custom-close-btn ml-1" (click)="deleteModalRef?.hide()" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <p>لطفاً انتخاب کنید که آیا مطمئن به حذف این سفارش هستید.</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="deleteModalRef?.hide()">خیر</button>
      <button type="button" class="btn btn-danger" (click)="confirmDeleteOrder()">بله</button>
    </div>
  </ng-template>
