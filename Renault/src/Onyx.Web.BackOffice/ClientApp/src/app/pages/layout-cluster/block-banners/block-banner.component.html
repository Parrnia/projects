<!-- Start Breadcrumbs -->
<app-breadcrumbs
  title="خوشه شخصی سازی قالب"
  [breadcrumbItems]="breadCrumbItems"
></app-breadcrumbs>
<!-- End Breadcrumbs -->

<div class="row">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title mb-0 flex-grow-1">لیست بلاک بنر</h4>
      </div>
      <!-- end card header -->

      <div class="card-body">
        <div class="mb-lg-3 row">
          <div class="col-lg-8">
            <div class="d-flex flex-wrap gap-2 mb-3 mb-lg-0">
              <button
                (click)="openInsertModal()"
                type="button"
                class="btn btn-outline-primary"
              >
                <i
                  class="icon-content-blue las la-plus label-icon align-middle fs-20"
                ></i>
              </button>
              <button
                (click)="deleteMultiple(deleteModel)"
                type="button"
                class="btn btn-outline-primary"
              >
                <i
                  class="icon-content-red las la-trash label-icon align-middle fs-20"
                ></i>
              </button>
            </div>
          </div>
          <!--end col-->

          <div class="col-lg-4">
            <div
              style="float: left"
              class="d-flex flex-wrap gap-2 mb-3 mb-lg-0"
            >
              <button type="button" (click)="openGetDetailExportExcelModal()" class="btn btn-outline-primary "><i
                  class="las la-file-excel label-icon align-middle fs-20"></i> </button>
              <button type="button" class="btn btn-outline-primary" (click)="exportExcel()"
                [class.btn-outline-loading]="inProgressAllExportbtn" [disabled]="inProgressAllExportbtn">
                <ng-container *ngIf="!inProgressAllExportbtn; else loadingTemplate">
                  <i class=" ri-file-excel-2-line label-icon align-middle fs-20"></i>
                </ng-container>
                <ng-template #loadingTemplate>
                  <span class="visually-hidden">Loading...</span>
                </ng-template>
              </button>
              <button type="button" class="btn btn-outline-primary">
                <i class="las la-file-upload label-icon align-middle fs-20"></i>
              </button>
              <button type="button" class="btn btn-outline-primary">
                <i class="las la-print label-icon align-middle fs-20"></i>
              </button>
            </div>
          </div>
          <!--end col-->
        </div>
        <!--end row-->

        <div class="search-box d-inline-block mb-2">
          <input
            type="text"
            class="form-control search"
            placeholder="جستجو ..."
            [(ngModel)]="service.searchTerm"
          />
          <i class="ri-search-line search-icon"></i>
        </div>

        <div class="table-responsive">
          <table class="table table-gridjs">
            <thead>
              <tr>
                <th style="width: 4px"></th>
                <th class="sort" sortable="title" (sort)="onSort($event)">
                  عنوان
                </th>
                <th class="sort" sortable="subtitle" (sort)="onSort($event)">
                  زیرعنوان
                </th>
                <th class="sort" sortable="buttonText" (sort)="onSort($event)">
                  متن دکمه
                </th>
                <th
                  class="sort"
                  sortable="blockBannerPositionName"
                  (sort)="onSort($event)"
                >
                  موقعیت روی صفحه
                </th>
                <th>تصویر</th>
                <th class="sort" sortable="isActive" (sort)="onSort($event)">
                  فعال
                </th>

                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let data of gridjsList$ | async"
                id="lj_{{ data.id }}"
              >
                <td>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      name="checkAll"
                      [checked]="isChecked(data.id)"
                      (change)="toggleCheckbox(data.id)"
                    />
                  </div>
                </td>
                <td>
                  <ngb-highlight
                    [result]="data.title"
                    [term]="service.searchTerm"
                  ></ngb-highlight>
                </td>
                <td>
                  <ngb-highlight
                    [result]="data.subtitle"
                    [term]="service.searchTerm"
                  ></ngb-highlight>
                </td>
                <td>
                  <ngb-highlight
                    [result]="data.buttonText"
                    [term]="service.searchTerm"
                  ></ngb-highlight>
                </td>
                <td>
                  <ngb-highlight
                    [result]="mapNemberKeyToString(data.blockBannerPosition)"
                    [term]="service.searchTerm"
                  ></ngb-highlight>
                </td>
                <td>
                  <img
                    *ngIf="data.image"
                    [src]="data.imageSrc"
                    alt="BlockBanner image"
                    style="max-width: 100px; max-height: 100px"
                  />
                </td>
                <td>
                  <strong *ngIf="data.isActive != null && data.isActive == true"
                    >بلی</strong
                  >
                  <strong
                    *ngIf="data.isActive == null || data.isActive == false"
                    >خیر</strong
                  >
                </td>
                <td
                  data-column-id="actions"
                  class=" gap-3 flex-wrap"
                >
                  <a
                    style="cursor: pointer"
                    (click)="edit(data)"
                    _ngcontent-agu-c388=""
                  >
                    <i
                      _ngcontent-agu-c388=""
                      class="las la-edit label-icon align-middle fs-22"
                    ></i>
                  </a>
                  <!-- <a _ngcontent-agu-c388="" (click)="openDeleteConfirmationModal(data.id)"
                                        class="link-danger fs-15">
                                        <i _ngcontent-agu-c388="" class="ri-delete-bin-line"></i>
                                    </a> -->
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="row justify-content-md-between align-items-md-center">
          <div class="col-sm-12 col-md-5">
            <div
              class="dataTables_info mb-2"
              id="tickets-table_info"
              role="status"
              aria-live="polite"
            >
              نمایش
              {{ service.totalRecords !== 0 ? service.startIndex : 0 }} تا
              {{ service.endIndex }} از {{ service.totalRecords }}
              داده
            </div>
          </div>
          <!-- Pagination -->
          <div class="col-sm-12 col-md-5">
            <div class="text-md-right float-md-end gridjs-pagination">
              <ngb-pagination
                [collectionSize]="(total$ | async)!"
                [maxSize]="10"
                [(page)]="service.page"
                [pageSize]="service.pageSize"
              >
              </ngb-pagination>
            </div>
          </div>
          <!-- End Pagination -->
        </div>
      </div>
      <!-- end card-body -->
    </div>
    <!-- end card -->
  </div>
  <!-- end col -->
</div>
<!-- end row -->

<ng-template #deleteModel let-modal>
  <div class="modal-content">
    <div class="modal-header">
      <button
        type="button"
        class="btn-close"
        data-bs-dismiss="modal"
        aria-label="Close"
        id="btn-close"
        (click)="modal.dismiss('Cross click'); this.handleCloseFormModal()"
      ></button>
    </div>
    <div class="modal-body">
      <div class="mt-2 text-center">
        <lord-icon
          src="https://cdn.lordicon.com/gsqxdxog.json"
          trigger="loop"
          colors="primary:#405189,secondary:#f06548"
          style="width: 90px; height: 90px"
        ></lord-icon>
        <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
          <h4>از حذف آیتم (های) انتخاب شده مطمئن هستید؟</h4>
          <p class="text-muted mx-4 mb-0">
            تایید حذف به منزله حذف داده از پایگاه داده می باشد
          </p>
        </div>
      </div>
      <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
        <button
          class="btn btn-link link-success fw-medium text-decoration-none"
          data-bs-dismiss="modal"
          (click)="modal.close('Close click')"
        >
          <i class="ri-close-line me-1 align-middle"></i> انصراف
        </button>
        <button
          type="button"
          class="btn w-sm btn-danger"
          [class.btn-loading]="inProgress" [disabled]="inProgress"
          id="delete-product"
          (click)="deleteItems()"
        >
         <ng-container *ngIf="!inProgress; else loadingTemplate">
            حذف کن
          </ng-container>
          <ng-template #loadingTemplate>
            <span class="visually-hidden">Loading...</span>
          </ng-template>
        </button>

      </div>
    </div>
  </div>
  <!-- /.modal-content -->
</ng-template>

<!-- Delete Modal -->
<ng-template role="document" #formModal let-modal>
  <form class="row gy-1" [formGroup]="myForm" (ngSubmit)="onSubmit()">
    <div class="modal-header">
      <h4 class="modal-title">بلاک بنر</h4>
      <button
        type="button"
        class="close"
        aria-label="Close"
        (click)="modal.dismiss(); this.handleCloseFormModal()"
      >
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="row modal-body">
      <div class="mb-3 col-xxl-6 col-md-6">
        <label for="title" class="form-label">عنوان</label>
        <input
          type="input"
          class="form-control"
          id="title"
          formControlName="title"
          [ngClass]="{
            'is-invalid': form.title.touched && form.title.invalid
          }"
        />
        <div
          *ngIf="form.title.touched && form.title.errors?.required"
          class="invalid-feedback"
        >
          وارد کردن عنوان اجباریست
        </div>
      </div>
      <!--end col-->

      <div class="mb-3 col-xxl-6 col-md-6">
        <label for="subtitle" class="form-label">زیرعنوان</label>
        <input
          type="input"
          class="form-control"
          id="subtitle"
          formControlName="subtitle"
          [ngClass]="{
            'is-invalid': form.subtitle.touched && form.subtitle.invalid
          }"
        />
        <div
          *ngIf="form.subtitle.touched && form.subtitle.errors?.required"
          class="invalid-feedback"
        >
          وارد کردن زیرعنوان اجباریست
        </div>
      </div>
      <!--end col-->

      <div class="mb-3 col-xxl-6 col-md-6">
        <label for="buttonText" class="form-label">متن دکمه</label>
        <input
          type="input"
          class="form-control"
          id="buttonText"
          formControlName="buttonText"
          [ngClass]="{
            'is-invalid': form.buttonText.touched && form.buttonText.invalid
          }"
        />
        <div
          *ngIf="form.buttonText.touched && form.buttonText.errors?.required"
          class="invalid-feedback"
        >
          وارد کردن متن دکمه اجباریست
        </div>
      </div>
      <!--end col-->
      <div class="mb-3 col-xxl-6 col-md-6">
        <app-file-upload
          [title]="'تصویر '"
          [savedFileId]="form.image.value"
          [savedFileUrl]="selectedFileUrl"
          [isRequired]="true"
          (uploadResponseEvent)="onFileSelected($event)"
        ></app-file-upload>
        <div class="mt-1 text-danger" *ngIf="form.image.touched && form.image.errors?.required">
          وارد کردن تصویر اجباریست
        </div>
      </div>
      <!--end col-->

      <div class="mb-3 col-xxl-6 col-md-6">
        <label for="typeSubMenu" class="form-label">موقعیت روی صفحه</label>
        <select
          [(ngModel)]="blockBannerPosition"
          style="margin-bottom: 0px !important"
          class="form-select mb-3"
          aria-label="موقعیت روی صفحه"
          id="blockBannerPosition"
          [ngClass]="{
            'is-invalid':
              form.blockBannerPosition.touched &&
              form.blockBannerPosition.invalid
          }"
          formControlName="blockBannerPosition"
        >
          <option
            *ngFor="let key of getNumericKeys()"
            [value]="blockBannerPositions[key]"
          >
            {{ mapNumericKeyToString(key) }}
          </option>
        </select>
        <div
          *ngIf="
            form.blockBannerPosition.touched &&
            form.blockBannerPosition.errors?.required
          "
          class="invalid-feedback"
        >
          انتخاب موقعیت روی صفحه اجباریست
        </div>
        <div
          *ngIf="
            form.blockBannerPosition.touched &&
            form.blockBannerPosition.errors?.blockBannerTaken
          "
          class="invalid-feedback"
        >
          یک بلاک بنر با این موقعیت روی صفحه موجود است
        </div>
        <div
          *ngIf="
            form.blockBannerPosition.touched && form.blockBannerPosition.pending
          "
        >
          یگانگی بلاک بنر در حال بررسی است
        </div>
      </div>
      <!--end col-->

      <div class="form-check form-switch mb-3 col-xxl-6 col-md-6 w-auto">
        <input
          class="form-check-input"
          type="checkbox"
          role="switch"
          id="isActive"
          formControlName="isActive"
          [ngClass]="{
            'is-invalid': form.isActive.touched && form.isActive.invalid
          }"
        />
        <label class="form-check-label" for="isActive">فعال</label>
      </div>
      <!--end col-->

      <div class="modal-footer">
        <button
          type="button"
          (click)="modal.dismiss('Cross click'); this.handleCloseFormModal()"
          style="margin-left: 5px"
          class="btn btn-warning"
        >
          انصراف
        </button>
        <button
          type="button"
          (click)="resetForm()"
          style="margin-left: 5px"
          class="btn btn-warning"
        >
          پاک کردن فرم
        </button>
        <button class="btn btn-primary" [class.btn-loading]="inProgress" [disabled]="inProgress" type="submit">
          <ng-container *ngIf="!inProgress; else loadingTemplate">
            ذخیره
          </ng-container>
          <ng-template #loadingTemplate>
            <span class="visually-hidden">Loading...</span>
          </ng-template>
        </button>

        <!-- <button type="submit" class="btn btn-primary border border-dark">ذخیره</button> -->
      </div>
    </div>
  </form>
</ng-template>

<ng-template #getDetailExportTabModel let-modal>
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btn-close"
        (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
      <app-export-excel-modal [client]="this.client" [clientQuery]="'exportExcelQuery'">

      </app-export-excel-modal>
    </div>
  </div>
</ng-template>
