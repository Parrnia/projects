<div *ngIf="order">
    <div class="order-header">
        <div class="order-header__actions">
            <a routerLink="/account/orders" class="btn btn-xs btn-secondary">{{ 'BUTTON_BACK_TO_LIST'|translate }}</a>
        </div>
    </div>
    <div class="order-header-detail row row-cols-1 row-cols-sm-2 row-cols-md-3 p-1 p-md-2 shadow rounded m-0">
        <p class="my-1 p-1"> <strong>{{'INPUT_ORDER_ID_LABEL'|translate}}:</strong> {{ order.number }}</p>
        <span class="my-1 p-1"> <strong>{{'ORDER_RIGISTERED_AT'|translate}}:</strong> {{ order.createdAt }}</span>
        <span class="my-1 p-1"> <strong>{{'TABLE_QUANTITY'|translate}}:</strong> {{ order.items.length }}</span>
        <span class="my-1 p-1"> <strong>{{'TEXT_TOTAL'|translate}}:</strong> {{ order.total|currencyFormat }}</span>
        <span class="my-1 p-1"> <strong>{{'TABLE_SUBTOTAL'|translate}}:</strong> {{ order.subtotal|currencyFormat }}</span>
        <span class="my-1 p-1"> <strong>{{'TEXT_PAYMENT_METHOD'|translate}}:</strong> {{
            getStringPaymentType(order.payment) }}</span>
    </div>

    <div class="row p-1 p-md-2 shadow rounded my-3 m-0 order-body-details">
        <div class="row m-0 p-1 col ">
            <div class="card-table p-0 m-0">
                <div class="table-responsive">
                    <table class="m-0 p-0 table-responsive">
                        <thead>
                            <tr>
                                <th class="text-center">{{ 'TABLE_IMAGE'|translate }}</th>
                                <th class="text-center">{{ 'TABLE_PRODUCT'|translate }}</th>
                                <th class="text-center">{{ 'TABLE_PRICE'|translate }}</th>
                                <th class="text-center">{{ 'TABLE_QUANTITY'|translate }}</th>
                                <th class="text-center">قیمت کل</th>
                                <th class="text-center">{{ 'TABLE_DISCOUNTONPRODUCT'|translate }}</th>
                                <th class="text-center">{{ 'TEXT_PRODUCT_TOTAL_AFTER_DISCOUNT'|translate }}</th>
                            </tr>
                        </thead>
                        <tbody class="card-table__body card-table__body--merge-rows">
                            <tr *ngFor="let item of order.items">
                                <td class="text-center"><img [src]="item.selectedProductAttributeOption.productImage"
                                        alt="" class="img-fluid" style="max-width: 50px; height: auto;"></td>
                                <td class="text-center">{{ item.selectedProductAttributeOption.productName }}</td>
                                <td class="text-center">{{ item.price|currencyFormat }}</td>
                                <td class="text-center"> {{item.quantity}} </td>
                                <td class="text-center"> {{item.total|currencyFormat}} </td>
                                <td class="text-center">{{item.price * item.totalDiscountPercent}} </td>
                                <td class="text-center"> {{item.total + ((item.price *
                                    item.totalDiscountPercent))|currencyFormat}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row m-0 p-1 col">
            <div *ngFor="let total of order.totals" class="row col-12 m-0 p-0">
                <div class="row justify-content-between align-items-center col-12 py-1 m-0 p-0 ">
                    <strong>{{ total.title|translate }} :</strong>
                    <div
                        *ngIf="total.type !== 'freeShipping' && total.type !== 'discountOnProduct' && total.type !== 'discountOnCustomerType'">
                        {{ total.price|currencyFormat }}
                    </div>
                    <div *ngIf="total.type === 'freeShipping'">
                        رایگان
                    </div>
                    <div *ngIf="total.type === 'discountOnProduct'">
                        {{ total.price*-1|currencyFormat }}
                    </div>
                    <div *ngIf="total.type === 'discountOnCustomerType'">
                        {{ total.price*-1|currencyFormat }}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="returnOrders.length > 0; else noOrders" class="modal-content shadow p-4 rounded bg-white mb-4">
        <h4 class="mb-4">سفارش‌های مرجوعی</h4>

        <div class="table-responsive">
          <table class="table table-striped table-bordered table-hover mb-4">
            <thead>
      <tr>
        <th scope="col">شماره سفارش بازگشت</th>
        <th scope="col">شماره سفارش</th>
        <th scope="col">تعداد کل</th>
        <th scope="col">تاریخ ثبت مرجوعی</th>
        <th scope="col">مجموع</th>
        <th scope="col">تعداد</th>
        <th scope="col">وضعیت</th>
        <th scope="col">اطلاعات حساب مشتری</th>
        <th scope="col">شیوه بازگشت</th>
        <th scope="col">جزئیات</th>
        <th scope="col">عملیات</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let returnOrder of returnOrders">
        <td>{{ returnOrder.number }}</td>
        <td>{{ returnOrder.orderNumber }}</td>
        <td>{{ returnOrder.quantity }}</td>
        <td>{{ returnOrder.createdAtText }}</td>
        <td>{{ (returnOrder.subtotal ?? 0) | currencyFormat }}</td>
        <td>{{ returnOrder.quantity }}</td>
        <td>
          <span [ngClass]="{
            'badge': true,
            'badge-success': returnOrder.currentReturnOrderState?.returnOrderStatus === ReturnOrderStatus.Completed,
            'badge-warning': returnOrder.currentReturnOrderState?.returnOrderStatus === ReturnOrderStatus.PendingForRegister || 
                             returnOrder.currentReturnOrderState?.returnOrderStatus === ReturnOrderStatus.Registered,
            'badge-danger': returnOrder.currentReturnOrderState?.returnOrderStatus === ReturnOrderStatus.Rejected || 
                            returnOrder.currentReturnOrderState?.returnOrderStatus === ReturnOrderStatus.Canceled
          }">
            {{ getReturnOrderStatusText(returnOrder.currentReturnOrderState?.returnOrderStatus) }}
          </span>
        </td>
        <td>{{ returnOrder.customerAccountInfo || 'موجود نیست' }}</td>
        <td>{{ getTransportationTypeText(returnOrder.returnOrderTransportationType) }}</td>
        <td>
          <button type="button" class="btn btn-info btn-sm" (click)=" detailsmodal(returnOrder.id!)">
            <i class="fas fa-ellipsis-h"></i> 
          </button>
        </td>
        <td>
          <button 
            *ngIf="returnOrder.currentReturnOrderState?.returnOrderStatus === ReturnOrderStatus.Accepted" 
            type="button" 
            class="btn btn-warning btn-sm"
            (click)="modalsenddata(returnOrder.id!)">
            ارسال اطلاعات
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  
  <div *ngIf="senddata" class="modal fade show d-block" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailsModalLabel">فرم اطلاعات</h5>
          <button type="button" class="close ml-2" (click)="closemodalsenddata()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="submitModalForm()" #infoForm="ngForm">
            <div class="mb-3">
              <label for="details" class="form-label">جزئیات</label>
              <input type="text" class="form-control" id="details" [(ngModel)]="modalData.details" name="details" required />
            </div>
  
            <div class="mb-3">
              <label for="shippingPrice" class="form-label">قیمت ارسال</label>
              <div class="input-group">
                <input 
                  type="text" 
                  class="form-control" 
                  id="shippingPrice" 
                  [(ngModel)]="modalData.returnShippingPrice" 
                  name="shippingPrice" 
                  required 
                  (input)="validateShippingPrice()" 
                  pattern="^\d+$" 
                  placeholder="مقدار را وارد کنید"
                />
                <span class="input-group-text">تومان</span>
              </div>
              
              
              <div *ngIf="isPriceNegative" class="text-danger">
                قیمت ارسال نباید منفی باشد.
              </div>
            </div>
  
            <div class="mb-3">
              <label for="transportationType" class="form-label">شیوه بازگشت</label>
              <select class="form-control" id="transportationType" [(ngModel)]="modalData.returnOrderTransportationType" name="transportationType" required>
                <option [ngValue]="ReturnOrderTransportationType.CustomerReturn">بازگشت توسط مشتری</option>
                <option [ngValue]="ReturnOrderTransportationType.OrganizationReturn">بازگشت توسط سازمان</option>
                <option [ngValue]="ReturnOrderTransportationType.OnLocation">در محل</option>
                <option [ngValue]="ReturnOrderTransportationType.NotDetermined">نامشخص</option>
              </select>
            </div>
  
            <div [formGroup]="documentFrom1" class="row row-cols-1 m-0 p-0 align-items-center">
              <label class="my-2">
                <span class="mb-1">توضیحات</span>
                <input 
                  [class.is-invalid]="documentFrom1.controls['description'].invalid && documentFrom1.controls['description'].touched"
                  formControlName="description" 
                  class="form-control" 
                  type="text"
                  placeholder="توضیحات مدارک"
                />
                <div class="invalid-feedback">
                  <div *ngIf="documentFrom1.controls['description'].hasError('required')">
                    {{ 'ERROR_FORM_REQUIRED' | translate }}
                  </div>
                </div>
              </label>
            
              <div>
                <app-file-upload 
                  [title]="'تصویر'"
                  [savedFileId]="documentFrom1.controls['imageContent'].value" 
                  [isRequired]="true"
                  [savedFileUrl]="imageUrl"
                  (uploadResponseEvent)="onFileSelected1($event , i)">
                </app-file-upload>
            
                <div *ngIf="documentFrom1.controls['imageContent'].touched && documentFrom1.controls['imageContent'].errors?.['required']"
                     class="mt-1 text-danger" style="font-size: 11px;">
                  وارد کردن تصویر اجباریست
                </div>
              </div>
            
              <button type="button" class="btn-primary btn col-8 mx-auto my-2" (click)="addToDocListItem1()">اضافه کردن به لیست</button>
            </div>
            
            <table class="table mt-3">
              <thead>
                <tr>
                  <th>#</th>
                  <th scope="col">تصویر</th>
                  <th scope="col">توضیحات</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of modalData.documentCommandForTotals; let i = index">
                  <th>{{ i + 1 }}</th>
                  <td>
                    <img [src]="imageService.makeImageUrlTemp(item.image)" alt="image item"
                         class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
                  </td>
                  <td>{{ item.description }}</td>
                  <td>
                    <button (click)="removeFromDocListItem(i)" type="button"
                            class="btn btn-danger d-flex justify-content-center align-items-center p-1">
                      <app-icon icon="recycle-bin-16"></app-icon>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            
  
            <button type="submit" class="btn btn-success" [disabled]="isPriceNegative">ذخیره و ارسال</button>
            <div *ngIf="successMessage" class="alert alert-success mt-3">
              {{ successMessage }}
            </div>
            
            <div *ngIf="errorMessage" class="alert alert-danger mt-3">
              {{ errorMessage }}
            </div>
          </form>
        </div>
      </div>
    </div>

  </div>
  

      </div>
      </div>
      <ng-template #noOrders>
      </ng-template>
      
      <div *ngIf="details" class="modal fade show d-block" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
       <div class="modal-dialog modal-xl" role="document">
         <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="detailsModalLabel">جزئیات سفارش مرجوعی</h5>
              <button type="button" class="close ml-2" (click)="closedetailsmodal()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
      
            <div class="modal-body">
              <ul class="nav nav-tabs">
                <li class="nav-item">
                  <a class="nav-link" [class.active]="selectedTab === 1" (click)="selectTab(1)">جزئیات سفارش</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" [class.active]="selectedTab === 2" (click)="selectTab(2)">هزینه های جانبی</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" [class.active]="selectedTab === 3" (click)="selectTab(3)">وضعیت های سفارش</a>
                </li>
             
              </ul>
      
              <div class="tab-content mt-3">
                <div *ngIf="selectedTab === 1" class="tab-pane fade show active">
                    <table class="table table-striped table-bordered table-hover mb-4">
                        <thead>
                          <tr>
                            <th scope="col">نام کالا</th>
                            <th scope="col">نام لاتین کالا</th>
                            <th scope="col">قیمت</th>
                            <th scope="col">تخفیف کل محصول</th>
                            <th scope="col">کد کالا</th>
                            <th scope="col">جزئیات</th> 
                          </tr>
                        </thead>
                      
                        <tbody>
                         
                            
                            <ng-container *ngFor="let item of selectedReturnOrder?.itemGroups ">
                              <tr>
                                <td>{{ item.productLocalizedName }}</td>
                                <td>{{ item.productName }}</td>
                                <td>{{ item.price }}</td>
                                <td>{{ item.totalDiscountPercent }}</td>
                                <td>{{ item.id }}</td>
                                <td>
                                  <button class="btn btn-info btn-sm " (click)="returnitems(item.id )">
                                    ...
                                  </button>
                                </td>
                              </tr>
                            </ng-container>

                        </tbody>
                      </table>
                      
                      <div *ngIf="returnitem" class="modal fade show d-block" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="detailsModalLabel">جزئیات کالا</h5>
                              <button type="button" class="close ml-2" (click)="closereturnitems()" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>
                            <div class="modal-body">
                                <ul class="nav nav-tabs">
                                    <li class="nav-item">
                                      <a class="nav-link" [class.active]="selectedTab1 === 1" (click)="selectTab1(1)">آیتم های مرجوعی</a>
                                    </li>
                                    <li class="nav-item">
                                      <a class="nav-link" [class.active]="selectedTab1 === 2" (click)="selectTab1(2)">آپشن های سفارشات مرجوعی </a>
                                    </li>
                                    
                                  </ul>
                                  <div class="tab-content mt-3">
                                    <div *ngIf="selectedTab1 === 1" class="tab-pane fade show active">
                                        <table class="table table-striped table-bordered table-hover mb-4 large-table">
                                            <thead>
                                              <tr>
                                                <th scope="col">جمع کل قیمت های ایتم های بازگشتی</th>
                                                <th scope="col">توضیحات دلیل باز گشت کالا</th>
                                                <th scope="col"> دسته بندی نوع دلیل باز گشت کالا</th>
                                                <th scope="col"> نوع دلیل باز گشت کالا سمت مشتری</th>
                                                <th scope="col"> نوع دلیل باز گشت کالا سمت سازمان</th>
                                                <th scope="col">پذیرفته شده</th>
                                                <th scope="col">جزئیات</th>
                                              </tr>
                                            </thead>
                                            
                                            <tbody>

                                                  <ng-container *ngFor="let item of selectedReturnOrderItemGroup?.returnOrderItems">
                                                    <tr>
                                                      <td>{{ item.total }}</td>
                                                      <td>{{ item.returnOrderReason?.details }}</td>
                                                      <td>{{  getReturnReasonType(item.returnOrderReason?.returnOrderReasonType) }}</td>
                                                      <td>{{getCustomerReasonType(item.returnOrderReason?.customerType)}}</td>
                                                      <td>{{getOrganizationReasonType( item.returnOrderReason?.organizationType)}}</td>
                                                      <td>
                                                        <ng-container *ngIf="item.isAccepted; else notAccepted">
                                                          بلی
                                                        </ng-container>
                                                        <ng-template #notAccepted>
                                                          خیر
                                                        </ng-template>
                                                      </td>
                                                      
                                                      <button class="btn btn-info btn-sm mt-2 mr-3" (click)="documentmodal(item.id)">
                                                        ...
                                                      </button>
                                                    </tr>
                                                  </ng-container>
                                            
                                            </tbody>
                                          </table>
                                          <div *ngIf="documents" class="modal fade show d-block" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
                                            <div class="modal-dialog modal-ml" role="document">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="detailsModalLabel">مستندات</h5>
                                                    <button type="button" class="close ml-2" (click)="closedocumentmodal()" aria-label="Close">
                                                      <span aria-hidden="true">&times;</span>
                                                    </button>
                                                  </div>
                                                <div class="modal-body">
                                                    <table class="table table-striped table-bordered table-hover mb-4 large-table">
                                                        <thead>
                                                          <tr>
                                                            <th scope="col">توضیحات</th>
                                                            <th scope="col">تصویر</th>
                                                          </tr>
                                                        </thead>
                                                        
                                                        <tbody>
                                                              <ng-container *ngFor="let item of selectedReturnOrderItems?.returnOrderItemDocuments">
                                                                <tr>
                                                                  <td>{{ item.description }}</td>
                                                                  <div class="d-flex justify-content-center align-items-center" >
                                                                    <img [src]="allItemDocImage$ | async" alt="Document Image" style="max-width: 100px; max-height: 100px; object-fit: cover;">
                                                                </div>
                                                                </tr>
                                                              </ng-container>
                                                        
                                                        </tbody>
                                                      </table>
                                                </div>
                                             
                                              </div>
                                            </div>
                                          </div>
                                          
                                      </div>
                                      <div *ngIf="selectedTab1 === 2" class="tab-pane fade show active">
                                        <table class="table table-striped table-bordered table-hover mb-4 large-table">
                                            <thead>
                                              <tr>
                                                <th scope="col">نام</th>
                                                <th scope="col">آپشن</th>
                                              
                                              </tr>
                                            </thead>
                                            
                                            <tbody>

                                                  <ng-container *ngFor="let item of selectedReturnOrderItemGroup?.optionValues">
                                                    <tr>
                                                      <td>{{ item.name }}</td>
                                                      <td>{{ item.value }}</td>
                                                      
                                                    </tr>
                                                       
                                                  </ng-container>
                                            
                                            </tbody>
                                          </table>
                                      </div>
                                    </div>
                            </div>
                         
                          </div>
                        </div>
                      </div>
                      
                      
                </div>
                <div *ngIf="selectedTab === 2" class="tab-pane fade show active">
                    <table class="table table-striped table-bordered table-hover mb-4 large-table">
                        <thead>
                          <tr>
                            <th scope="col">عنوان</th>
                            <th scope="col">مبلغ</th>
                            <th scope="col">نوع</th>
                            <th scope="col">الگوی اعمال هزینه</th>
                            <th scope="col">جزئیات</th>
                          </tr>
                        </thead>
                        
                        <tbody>
                              <ng-container *ngFor="let item of selectedReturnOrder?.totals">
                                <tr>
                                  <td>{{ item.title }}</td>
                                  <td>{{ item.price }}</td>
                                  <td>{{ item.typeName }}</td>
                                  <td>{{ item.returnOrderTotalApplyTypeName }}</td> 
                                  <div class="d-flex justify-content-center align-items-center" >
                                    <button class="btn btn-info btn-sm mt-2" (click)="costdocument(item.id)">
                                     ...
                                    </button>
                                  </div>
                                  
                                  
                                </tr>
                              </ng-container>
                        
                        </tbody>
                      </table>
                      </div>
                 
                      <div *ngIf="costdocuments" class="modal fade show d-block" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
                        <div class="modal-dialog " role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="detailsModalLabel">لیست مستندات</h5>
                                <button type="button" class="close ml-2" (click)="closecostdocument()" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                            <div class="modal-body">
                                <table class="table table-striped table-bordered table-hover mb-4 large-table">
                                    <thead>
                                      <tr>
                                        <th scope="col">توضیحات</th>
                                        <th scope="col">تصویر</th>
                            
                                      </tr>
                                    </thead>
                                    
                                    <tbody>
                                      <ng-container *ngFor="let item of safeReturnOrderItemsDoc">
                                                                                  <tr>
                                              <td>{{ item.returnOrderTotalDocuments }}</td>
                                              
                                              <div class="d-flex justify-content-center align-items-center" >
                                                <img [src]="allItemcostDocImage$ | async" alt="Document Image" style="max-width: 100px; max-height: 100px; object-fit: cover;">
                                            </div>
                                                 
                                            </tr>
                                          </ng-container>
                                    
                                    </tbody>
                                  </table>
                            </div>
                         
                          </div>
                        </div>
                      </div>
                      
                  </div>
                <div *ngIf="selectedTab === 3" class="tab-pane fade show active">
                    <table class="table table-striped table-bordered table-hover mb-4 large-table">
                        <thead>
                          <tr>
                            <th scope="col">وضعیت</th>
                            <th scope="col">جزئیات</th>
                            <th scope="col">تاریخ</th>
                          </tr>
                        </thead>
                        
                        <tbody>
                              <ng-container *ngFor="let item of selectedReturnOrder?.returnOrderStateHistory">
                                <tr>
                                  <td>{{ item.returnOrderStatusName }}</td>
                                  <td>{{ item.details }}</td>
                                  <td>{{ item.created }}</td>
                                </tr>
                              </ng-container>
                        
                        </tbody>
                      </table>
                </div>
              
              </div>
            </div>
      
        
          </div>
        </div>
      </div>
      
    <form [formGroup]="customerAccountInfoForm" (ngSubmit)="OnSubmitCommand()"
        class="modal-content shadow p-4 rounded bg-white " style="box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);">
        <div class="p-1 mb-3">
            <div style="display: flex; align-items: center;">
                <button type="button" (click)="openSelectItemModal()" class="btn btn-primary rounded mx-1">
                    افزودن گروه
                </button>
            </div>
        </div>

        <ul class="nav row m-0 p-0">
            <li class="nav-item col-12 my-2 row m-0 align-items-start justify-content-between rounded"
                *ngFor="let itemGroup of returnOrderItemGroupModels, let i = index">
                <div class="d-flex flex-wrap w-100 align-items-start gap-3">
                    <div class="card-table-main flex-grow-1 p-1 p-md-2 shadow rounded order-body-details">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover table-striped m-0 table-custom">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-center" style="width: 20%;">{{ 'TABLE_PRODUCT' | translate }}
                                        </th>
                                        <th class="text-center" style="width: 20%;">{{ 'TABLE_PRODUCTNO' | translate }}
                                        </th>
                                        <th class="text-center" style="width: 20%;">{{ 'TABLE_PRODUCT_BRAND' | translate
                                            }}</th>
                                        <th class="text-center" style="width: 20%;">{{ 'TEXT_CATEGORIES' | translate }}
                                        </th>
                                        <th class="text-center" style="width: 20%;">{{ 'TABLE_IMAGE' | translate }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="text-center">{{ itemGroup.productName }}</td>
                                        <td class="text-center">{{ itemGroup.productNo }}</td>
                                        <td class="text-center">{{ itemGroup.productBrandName }}</td>
                                        <td class="text-center">{{ itemGroup.productCategory }}</td>
                                        <td class="text-center">
                                            <img [src]="itemGroup.productImage" alt="" class="img-fluid">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="d-flex align-items-center gap-2">
                        <button (click)="openReturnFormItemModal(itemGroup.groupCommand.productAttributeOptionId ?? 0)"
                            type="button" class="btn btn-primary btn-sm">
                            افزودن آیتم سفارش
                        </button>
                        <button type="button" class="btn btn-danger btn-sm"
                            (click)="removeItemGroup(itemGroup.groupCommand.productAttributeOptionId ?? 0)">
                            حذف
                        </button>
                    </div>
                </div>

                <ul class="p-0 nav row col-12 m-0">
                    <li class="nav-item col-12 py-2 row m-0 align-items-center justify-content-between rounded"
                        *ngFor="let item of itemGroup.groupCommand.orderItems, let i = index">
                        <div class="py-2 w-100">
                            <div class="d-flex flex-wrap w-100 align-items-start gap-3">
                                <div class="card-table-main flex-grow-1 p-1 p-md-2 shadow rounded order-body-details">
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover table-striped m-0 table-custom">
                                            <thead class="table-light">
                                                <tr>
                                                    <th class="text-center">{{ 'TABLE_QUANTITY' | translate }}</th>
                                                    <th class="text-center">{{ 'RETURN_ORDER_REASON_TYPE' | translate }}
                                                    </th>
                                                    <th class="text-center">{{ 'DETAILS' | translate }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td class="text-center">{{ item.quantity }}</td>
                                                    <td class="text-center">{{
                                                        mapNumericKeyToString((item.returnOrderReason?.customerType ??
                                                        item.returnOrderReason?.organizationType) ?? 0 )}}</td>
                                                    <td class="text-center">{{ item.returnOrderReason?.details }}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="d-flex align-items-center gap-2">
                                    <button
                                        (click)="openAddDocumentModal(itemGroup.groupCommand.productAttributeOptionId ?? 0, item.id)"
                                        data-toggle="tooltip" title="بارگذاری تصاویر" type="button"
                                        class="btn btn-primary btn-sm">
                                        <app-icon icon="bi-file-earmark-arrow-up"></app-icon>
                                    </button>
                                    <button type="button" class="btn btn-danger btn-sm"
                                        (click)="removeItem(itemGroup.groupCommand.productAttributeOptionId ?? 0, item.id)">
                                        حذف
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>

        <div>
            <div class="modal-header d-flex align-items-center p-3">
                <label for="value" class="w-100">
                    <span class="mb-1 d-flex fw-bold">اطلاعات حساب مشتری</span>
                    <textarea formControlName="value" class="form-control" id="value" rows="3"
                        [ngClass]="{ 'is-invalid': customerAccountInfoForm.get('value')?.invalid && customerAccountInfoForm.get('value')?.touched && getStringPaymentType(order.payment) === 'آنلاین' }"
                        [required]="getStringPaymentType(order.payment) === 'آنلاین'">
                    </textarea>
                    <div *ngIf="customerAccountInfoForm.get('value')?.invalid && customerAccountInfoForm.get('value')?.touched && getStringPaymentType(order.payment) === 'آنلاین'"
                        class="text-danger mt-1">
                        لطفاً اطلاعات حساب مشتری را وارد کنید.
                    </div>
                </label>
            </div>

            <div class="modal-header d-flex align-items-center p-3">
                <label for="details" class="w-100">
                    <span class="mb-1 d-flex fw-bold">توضیحات درخواست</span>
                    <textarea formControlName="details" class="form-control" id="details" rows="3"
                        [ngClass]="{ 'is-invalid': customerAccountInfoForm.get('details')?.invalid && customerAccountInfoForm.get('details')?.touched }">
                    </textarea>
                    <div *ngIf="customerAccountInfoForm.get('details')?.invalid && customerAccountInfoForm.get('details')?.touched"
                        class="text-danger mt-1">
                        لطفاً توضیحات درخواست را وارد کنید.
                    </div>
                </label>
            </div>
            <div class="row justify-content-between align-items-center py-2 m-0 p-0 text-end">
                <div class="col-6">
                    <strong>{{ 'RETURN_ORDER_TOTAL' | translate }} :</strong>
                    <span>{{ returnOrderTotal | currencyFormat }}</span>
                </div>
                <div class="col-6">
                    <strong>{{ 'RETURN_ORDER_QUANTITY' | translate }} :</strong>
                    <span>{{ returnOrderQuantity }}</span>
                </div>
                <div class="col-12 text-muted small mt-2">
                    سایر هزینه ها در ادامه به مبلغ قابل بازگشت اضافه می گردد
                </div>
            </div>

            <div class="modal-footer d-flex justify-content-end mt-4">
                <button type="button" class="btn btn-secondary me-2" data-dismiss="#selectItemModal"
                    (click)="resetAllForms()">انصراف</button>
                <button type="submit" class="btn btn-primary"
                    [disabled]="customerAccountInfoForm.invalid && getStringPaymentType(order.payment) === 'آنلاین'">ارسال
                    درخواست</button>
            </div>
        </div>
    </form>

    <!-- selectItemModal**************** -->
    <div class="modal fade p-0 m-0 h-screen row w-full" dir="rtl" tabindex="-1" role="dialog" bsModal
        #selectItemModal="bs-modal">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="dialog">
            <div class="modal-content shadow-lg">
                <div class="modal-header d-flex align-items-center p-3">
                    <h5 class="modal-title" id="exampleModalLabel">انتخاب آیتم مرجوعی</h5>
                    <button type="button" class="close m-0" data-dismiss="selectItemModal"
                        (click)="closeSelectItemModal()" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body d-flex justify-content-center align-items-center" style="max-height: 75vh; overflow-y: auto;">
                  <ul class="nav row m-0 p-0 w-100">
                      <li class="nav-item col-12 rounded row align-items-center py-2 m-0" *ngIf="order?.items && order.items.length > 0">
                          <div class="card-table p-0 m-0 w-100">
                              <div class="table-responsive w-100">
                                  <table class="table table-bordered table-striped table-hover table-sm m-0 p-0 w-100">
                                      <thead class="table-light">
                                          <tr>
                                              <th class="text-center" style="width: 5%;"> </th>
                                              <th class="text-center" style="width: 30%;">{{ 'TABLE_PRODUCT' | translate }}</th>
                                              <th class="text-center" style="width: 20%;">{{ 'TABLE_PRODUCTNO' | translate }}</th>
                                              <th class="text-center" style="width: 20%;">{{ 'TABLE_IMAGE' | translate }}</th>
                                          </tr>
                                      </thead>
                                      <tbody>
                                          <tr *ngFor="let item of order.items" (click)="toggleCheckbox(item)">
                                              <td class="text-center">
                                                  <label class="m-0" [for]="'item-' + i">
                                                      <input class="mx-2" [id]="'item-' + i" type="checkbox" name="checkAll" [checked]="isChecked(item)" (change)="toggleCheckbox(item)">
                                                  </label>
                                              </td>
                                              <td class="text-center">{{ item.selectedProductAttributeOption.productName }}</td>
                                              <td class="text-center">{{ item.selectedProductAttributeOption.productNo }}</td>
                                              <td class="text-center">
                                                  <img [src]="item.selectedProductAttributeOption.productImage" alt="" class="img-fluid" style="max-width: 50px; height: auto;">
                                              </td>
                                          </tr>
                                      </tbody>
                                  </table>
                              </div>
                          </div>
                      </li>
                  </ul>
              </div>
              

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="#selectItemModal"
                        (click)="closeSelectItemModal()">انصراف</button>
                    <button type="button" class="btn btn-primary" (click)="addItems()">اضافه کردن</button>
                </div>
            </div>
        </div>
    </div>


    <!-- returnFormItemModal************ -->
    <div class="modal fade p-0 m-0 h-screen row w-full" dir="rtl" tabindex="-1" role="dialog" bsModal
    #returnFormItemModal="bs-modal">
<div class="modal-dialog modal-dialog-centered" role="dialog">
    <form [formGroup]="returnOrderItemForm" (ngSubmit)="onSubmitReturnOrderItems()" class="modal-content">
        <div class="modal-header d-flex align-items-center p-2">
            <h5 class="modal-title" id="exampleModalLabel">برگشت محصول</h5>
            <button type="button" class="close m-0" data-dismiss="returnFormItemModal"
                (click)="closeReturnFormItemModal()" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div *ngIf="order?.items && order.items.length > 0" class="modal-body row row-cols-1 m-0">
            <label for="quantity" class="col-6 p-0 my-2">
                <span class="mb-1 d-flex">تعداد</span>
                <app-input-number [id]="'quantity-' + i" formControlName="quantity" [min]="0"
                    [max]="selectedOrderItemLimit" #numberInput></app-input-number>
            </label>
            <label [for]="'returnOrderReasonDetails-' + i" class="my-2">
                <div *ngIf="returnOrderItemForm.get('quantity')?.invalid && returnOrderItemForm.get('quantity')?.touched"
                    class="text-danger mt-1">
                    لطفاً تعداد صحیحی وارد کنید.
                </div>
            </label>
            <label for="returnOrderReasonDetails" class="my-2">
                <span class="mb-1 d-flex">دلیل مرجوعی</span>
                <textarea formControlName="returnOrderReasonDetails" class="form-control"
                    id="returnOrderReasonDetails" rows="3"
                    [ngClass]="{ 'is-invalid': returnOrderItemForm.get('returnOrderReasonDetails')?.invalid && returnOrderItemForm.get('returnOrderReasonDetails')?.touched }">
                </textarea>
                <div *ngIf="returnOrderItemForm.get('returnOrderReasonDetails')?.invalid && returnOrderItemForm.get('returnOrderReasonDetails')?.touched"
                    class="text-danger mt-1">
                    دلیل مرجوعی را وارد کنید.
                </div>
            </label>

            <label for="returnOrderReasonType" class="my-2">
                <span class="mb-1 d-flex">نوع دلیل</span>
                <select formControlName="returnOrderReasonType" id="returnOrderReasonType" class="form-control"
                    [ngClass]="{ 'is-invalid': returnOrderItemForm.get('returnOrderReasonType')?.invalid && returnOrderItemForm.get('returnOrderReasonType')?.touched }">
                    <option value="" disabled
                        [selected]="!returnOrderItemForm.get('returnOrderReasonType')?.value">انتخاب کنید
                    </option>

                    <option *ngFor="let value of returnOrderReasonTypes" [ngValue]="value">
                        {{ mapNumericKeyToString(value) }}
                    </option>
                </select>

                <div *ngIf="returnOrderItemForm.get('returnOrderReasonType')?.invalid && returnOrderItemForm.get('returnOrderReasonType')?.touched"
                    class="text-danger mt-1">
                    نوع دلیل را انتخاب کنید.
                </div>
            </label>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="#selectItemModal"
                (click)="closeReturnFormItemModal()">انصراف</button>
            <button type="submit" class="btn btn-primary" [disabled]="returnOrderItemForm.invalid">اضافه
                کردن</button>
        </div>
    </form>
</div>
</div>

    <!-- addDocumentModal*************** -->
    <div class="modal fade p-0 m-0 h-screen row w-full" dir="rtl" tabindex="-1" role="dialog" bsModal
        #addDocumentModal="bs-modal">
        <div class="modal-dialog modal-dialog-centered" role="dialog">
            <div class="modal-content">
                <div class="modal-header d-flex align-items-center p-2">
                    <h5 class="modal-title" id="exampleModalLabel">فایل های پیوست</h5>
                    <button type="button" class="close m-0" data-dismiss="returnFormItemModal"
                        (click)="closeAddDocumentModal()" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div [formGroup]="documentFrom" class="row row-cols-1 m-0 p-0 align-items-center">
                        <label class="my-2">
                            <span class="mb-1">توضیحات</span>
                            <input [class.is-invalid]="documentFrom.controls['description'] | isInvalid"
                                formControlName="description" class="form-control" type="text">
                            <div class="invalid-feedback">
                                <div *ngIf="documentFrom.controls['description'] | hasError:'required'">
                                    {{ 'ERROR_FORM_REQUIRED' | translate }}
                                </div>
                            </div>
                        </label>
                        <div>
                            <app-file-upload [title]="'تصویر'"
                                [savedFileId]="documentFrom.controls['imageContent'].value" [isRequired]="true"
                                [savedFileUrl]="this.imageUrl" (uploadResponseEvent)="onFileSelected($event)">
                            </app-file-upload>
                            <div *ngIf="documentFrom.controls['imageContent'].touched && documentFrom.controls['imageContent'].errors?.['required']"
                                class="mt-1 text-danger" style="font-size: 11px;">
                                وارد کردن تصویر اجباریست
                            </div>
                        </div>
                        <button type="button" class="btn-primary btn col-8 mx-auto my-2" (click)="addToDocListItem()">اضافه کردن به
                            لیست</button>
                    </div>
                    <table class="table mt-3">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th scope="col">تصویر</th>
                                <th scope="col">توضیحات</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of documentListItems; let i = index">
                                <th>{{ i + 1 }}</th>
                                <td>
                                    <img [src]="this.imageService.makeImageUrlTemp(item.image)" alt="image item"
                                        class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                </td>
                                <td>{{ item.description }}</td>
                                <td>
                                    <button (click)="removeFromDocListItem(i)" type="button"
                                        class="btn btn-danger d-flex justify-content-center align-items-center p-1">
                                        <app-icon icon="recycle-bin-16"></app-icon>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="#selectItemModal"
                        (click)="closeAddDocumentModal()">انصراف</button>
                    <button type="button" class="btn btn-primary" (click)="AddDocsToItem()">تایید</button>
                </div>
            </div>
        </div>
    </div>