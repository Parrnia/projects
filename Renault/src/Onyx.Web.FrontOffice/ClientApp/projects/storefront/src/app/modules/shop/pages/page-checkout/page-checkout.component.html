<app-block-header [pageTitle]="'HEADER_CHECKOUT'|translate" [breadcrumb]="[
        {label: 'LINK_HOME'|translate, url: url.home()},
        {label: 'LINK_CART'|translate, url: url.cart()},
        {label: 'LINK_CHECKOUT'|translate, url: url.checkout()}
    ]"></app-block-header>

<div class="checkout block" [formGroup]="form">
    <div class="container container--max--xl">
        <div class="row">
            <div class="col-12 col-lg-6 col-xl-7">
                <div class="card mb-lg-0">
                    <div class="card-body card-body--padding--2">
                        <h3 class="card-title">{{ 'HEADER_BILLING_DETAILS'|translate }}</h3>

                        <app-address-form formControlName="billingAddress" class="form-group d-block"
                            #billingAddressForm></app-address-form>

                        <div class="form-group">
                            <label for="checkout-comment">
                                {{ 'INPUT_ORDER_NOTES_LABEL'|translate }}
                                <span class="text-muted">
                                    ({{ 'TEXT_OPTIONAL'|translate }})
                                </span>
                            </label>
                            <textarea id="checkout-comment" class="form-control" rows="4"
                                formControlName="comments">{{ 'INPUT_ORDER_NOTES_PLACEHOLDER'|translate }}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-6 col-xl-5 mt-4 mt-lg-0">
                <div class="card mb-0">
                    <div class="card-body card-body--padding--2">
                        <h3 class="card-title">{{ 'HEADER_YOUR_ORDER'|translate }}</h3>

                        <table class="checkout__totals">
                            <thead class="checkout__totals-header">
                                <tr>
                                    <th>{{ 'TABLE_PRODUCT'|translate }}</th>
                                    <th>ویژگی های محصول</th>
                                    <th>{{ 'TABLE_TOTAL'|translate }}</th>
                                </tr>
                            </thead>
                            <tbody class="checkout__totals-products">
                                <tr *ngFor="let item of cart.items$|async">
                                    <td>{{ item.product.name }} × {{ item.quantity }}</td>
                                    <td class="cart-table__options small-element">
                                <tr *ngFor="let option of item.product.selectedAttributeOption.optionValues;">
                                    {{option.name}} : {{option.value}}</tr>
                                </td>
                                <td>{{ (item.product.selectedAttributeOption.compareAtPrice ?? item.product.selectedAttributeOption.price) * item.quantity|currencyFormat }}</td>
                                </tr>
                            </tbody>
                            <tbody *ngIf="(cart.totals$|async)?.length" class="checkout__totals-subtotals">
                                <tr>
                                    <th>{{ 'TABLE_SUBTOTAL'|translate }}</th>
                                    <td></td>
                                    <td>{{ ((cart.subtotal$|async) || 0)|currencyFormat }}</td>
                                </tr>
                                <tr *ngFor="let total of cart.totals$|async">
                                    <th>{{ 'TABLE_TOTAL_' + total.title|translate }}</th>
                                    <td></td>
                                    <td>
                                        <div *ngIf=" total.type !== 'discountOnProduct' && total.type !== 'discountOnCustomerType'">
                                            {{ total.price|currencyFormat }}
                                        </div>
                                        <div *ngIf="total.type === 'discountOnProduct'">
                                            {{ total.price*-1|currencyFormat }}
                                        </div>
                                        <div *ngIf="total.type === 'discountOnCustomerType'">
                                            {{ total.price*-1|currencyFormat }}
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot class="checkout__totals-footer">
                                <tr>
                                    <th>{{ 'TABLE_TOTAL'|translate }}</th>
                                    <td></td>
                                    <td>{{ ((cart.total$|async) || 0)|currencyFormat }}</td>
                                </tr>
                            </tfoot>
                        </table>

                        <!-- <div class="checkout__payment-methods payment-methods">
                            <ul class="payment-methods__list" formControlName="paymentMethod" appRadioGroup>
                                <li *ngFor="let payment of payments" class="payment-methods__item"
                                    appCollapseItem="payment-methods__item--active"
                                    [appCollapseItemIsOpen]="form.controls['paymentMethod'].value === payment.name">
                                    <label class="payment-methods__item-header">
                                        <app-radio-button class="payment-methods__item-radio"
                                            [value]="payment.name"></app-radio-button>
                                        <span class="payment-methods__item-title">
                                            {{ payment.label|translate }}
                                        </span>
                                    </label>
                                    <div class="payment-methods__item-container" appCollapseContent>
                                        <div class="payment-methods__item-details text-muted">
                                            {{ payment.description|translate }}
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div> -->

                        <div class="checkout__agree">
                            قیمت‌ها با احتساب مالیات بر ارزش افزوده هستند
                        </div>

                        <div class="checkout__agree form-group">
                            <div class="form-check">
                                <app-checkbox formControlName="agree" class="form-check-input"
                                    [class.is-invalid]="form.controls['agree']|isInvalid"
                                    #termsCheckbox="appCheckbox"></app-checkbox>
                                <label class="form-check-label" [htmlFor]="termsCheckbox.inputId"
                                    [appSplitString]="'INPUT_TERMS_AGREE_LABEL'|translate" #string="splitString">
                                    {{ string.getPart(0) }}
                                    <a [href]="'site/terms'" (click)="showTerms($event)">{{ string.getPart(1) }}</a>
                                    {{ string.getPart(2) }}
                                </label>
                            </div>
                        </div>

                        <button type="submit"
                            class="btn btn-primary btn-xl btn-block"
                            [class.btn-loading]="checkoutInProgress"
                            (click)="createOrder()">{{ 'BUTTON_PLACE_ORDER'|translate }}</button>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<app-block-space layout="before-footer"></app-block-space>